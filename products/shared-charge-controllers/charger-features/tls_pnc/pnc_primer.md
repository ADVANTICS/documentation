# Plug’n’Charge, a condensed primer
This short primer summarizes the core cryptographic concepts, actors and certificate flows used by Plug’n’Charge. It explains keys and certificates, how certificate chains and PKI elements (CA, CSR, CRL, OCSP) fit together, and which certificates are used by the main actors (SECC/CPO, EV/OEM, MO, CPS) during TLS handshakes and contract provisioning.

[Controllers configuration for TLS and Plug’n’Charge](./tls_pnc_config.md)

## General

### Keys

- **Private key**
    
    The secret key for signing and decrypting data.
    
- **Public key**
    
    The public key is used to encrypt data. This key cannot be used in any signing or decrypting operation. Public key is the signed part of the **key pairs**, which become a **certificate**.
    
- **Key pair**
    
    Combination of **private** and **public key**, generated in the same time as a pair.
    

### Certificates

- **Certificate**
    
    A **public key** that is signed by a **Certificate Authority**. There are also self-signed certificates.
    
- **Leaf certificate**
    
    A **certificate** for one particular entity (eg. server, device, user, contract, vehicle, etc.). Cannot sign any other certificate.
    
- **Root certificate**
    
    A self-signed **certificate** bootstrapping a **certificate chain**.
    

### Certificates signing

- **CA: Certificate Authority**
    
    An actor holding a **certificate** and its corresponding **private key**, such that it can sign other **certificates**.
    
- **CSR: Certificate Signing Request**
    
    Request containing a **public key**, sent to a **Certificate Authority**. The CA then signs this request, and creates a **certificate**.
    
- **Certificate chain**
    
    **Certificates** can be signed in a kind of chain. For example, a trustworthy root instance (**Root CA**) signs a sub-instance (**Sub-CA)** and this sign the individual certificate (**Leaf Certificate**). Using the certificate chain, an individual certificate can be expanded down to the root instance and validated against it.
    

### Certificates management

- **Pool of certificates**
    
    A service (web/REST) from which one can query particular **certificates**.
    
- **CRL: Certificate Revocation List**
    
    A certificate list to publish revoked and untrusted **certificates** for all actors. This list must be signed by the issuer **CA** to prove the authenticity.
    
- **OCSP Responder**
    
    An online component to publish the certificate statuses, if it is “good”, “revoked” or “unknown”. Different than **CRL**, OCSP responder publishes the certificate status of one certificate in each request.
    
- **PKI: Public Key Infrastructure**
    
    Common description of a cryptologic verification system for digital certificates. Basically, an organisation that implements many roles and responsibilities around certificates handling: holds certificate authorities, generate keys, signs, keep tabs of revoked certificate, etc.
    

## Plug’n’Charge specific

- **CPO: Charge Point Operator**
    
    Responsible for the management, and servicing of charging stations. Also handles billing, and invoicing of EV drivers.
    
- **MO: Mobility Operator**
    
    Offers charging-related services to EV drivers (find charging stations, authenticate, pay). Holds a commercial “e-mobility” contract with the EV owner/driver.
    
- **OEM: Original Equipment Manufacturer**
    
    But here it basically means vehicle manufacturer.
    
- **CertID, aka PCID: Provisioning Certificate ID**
    
    The unique identifier associated with the OEM provisioning certificate (ie. the leaf certificate installed in the vehicle by the manufacturer at production time).
    
- **Contract**
    
    In PnC context, just “contract” by itself means the e-mobility contract between an EV owner/driver and a MO. This is what basically authenticate a driver (or actually its vehicle) in order to bill/invoice a particular charge session. The digital form of this contract is [described below](#mobility-operator-mo).
    
- **eMAID: e-Mobility Account IDentifier**
    
    The unique identifier of a contract.
    
- **CPS: Certificate Provisioning Service**
    
    An intermediate between MO, OEM and CPO, owning certificate pools and acting as a central store of certificate information, resolving chains of trusts when needed. It also signs **contract data** generated by MO such that an EV can verify and trust a contract certificate when it is being installed of updated.
    
- **Contract data**
    
    The content of messages `CertificateInstallationRes` and `CertificateUpdateRes`, created by MO, signed by CPS, and transmitted by SECC to EVCC.
    

# Certificates and certificate chains

- **V2G Root CA**
    - A shared Certificate Authority trusted by various actors, and from which some certificates (but not all) can be verified up to it.
    - One per “region” of the globe (ie. per continent).
    - Vehicles must trust the V2G Root CA. Other parties like MO and OEM can optionally trust it as well in their processes.
    - SECC and CPS leaf certificates must be signed by a chain that leads up to the V2G Root CA.
    - Usages:
        - Must signs CPO and CPS Sub-CA 1
        - Optionally signs MO and OEM Sub-CA 1
        - EVCC verifies SECC leaf certificate during TLS handshake
        - EVCC verifies CPS signature of contract data during `CertificateInstallation` and `CertificateUpdate` processes

## **Charge Point Operator (CPO)**

- **SECC leaf certificate**
    - A certificate instance (and its private key) to be installed on each charging station.
    - Signed by CPO Sub-CA 2, chaining up to the V2G Root CA.
    - Used for TLS handshake.
- **CPO certificate chain**
    - The chain of certificate comprised of the V2G Root CA, 2 intermediate CPO Sub-CA, and finally a SECC leaf certificate.
    - Used for TLS handshake, such that EVCC can verify the SECC leaf certificate up to the V2G Root CA

## Vehicle (OEM)

- **OEM provisioning certificate**
    - A (leaf) certificate instance (and its private key) installed in the vehicle when it is manufactured.
    - Signed by an OEM Sub-CA 2, chaining up to an OEM Root CA (but not necessarily up to the V2G Root CA).
    - Used to authenticate a vehicle during the creation of a contract certificate.
        - NB: Not used during a typical charge session.
    - Typically never changes.
    - The Common Name (CN) of the contract certificate corresponds to the PCID (aka CertID), an identifier that the EV owner must receive (eg. mentioned on a particular piece of paper) when the vehicle is delivered to him/her, and gives to the MO when making a commercial contract with them, such that later on the CPS can find the actual OEM provisioning certificate in its pools.
    - Usages:
        - MO verifies this certificate (obtained from CPS, and its pools, using the PCID/CertID) before establishing the contract certificate
        - MO checks validity of this certificate against OCSP responder or CRL from OEM
        - EVCC sends this certificate in the element `OEMProvisioningCert` of `CertificateInstallationReq` message
        - EVCC signs content of `CertificateInstallationReq` and `CertificateUpdateReq` messages using the private key associated with this certificate
        - CPS verifies the certificate used to sign `CertificateInstallationReq` and `CertificateUpdateReq` messages
- **OEM certificate chain**
    - The chain of certificate comprised of the OEM Root CA, 2 intermediate OEM Sub-CA, and finally an OEM provisioning certificate.
    - Used by MO and CPS to verify vehicle leaf certificates and signatures made by an EV up to an OEM Root CA the CPS has in one of its pools.
    - Given by OEM to CPS using non-documented/private means.

## Mobility Operator (MO)

- **Contract**
    - A (leaf) certificate instance (and its private key) installed in the vehicle when a new commercial contract between an MO and a EV owner/driver is concluded. Note that the MO also keep the private key.
    - Signed by an MO Sub-CA, chaining up to an MO Root CA (but not necessarily to the V2G Root CA).
    - The Common Name (CN) of the contract certificate corresponds to the eMAID, following a particular format described in Appendix H.1.
    - Used in a charge session to authenticate that the vehicle does indeed hold the contract, and optionally sign some billing-related data (eg. metering).
    - Also used during charge parameter discovery to sign tariff data. Note that in this case, it is the MO who uses the contract private key to sign, and not the vehicle.
    - Usages:
        - EVCC sends its current contract certificate (and Sub CAs chain) to SECC in `ContractSignatureCertChain` element of `PaymentDetailsReq` and `CertificateUpdateReq` message
        - SECC verifies the contract certificate and its chain up to an MO Root CA it has locally, or to the V2G Root CA in case the MO Sub-CA 1 is signed by V2G Root CA
        - EVCC signs the content of `AuthorizationReq`, `MeteringReceiptReq`, and `CertificateUpdateReq` messages using the private key of the contract associated to this certificate.
        - SECC verifies EVCC signature of `AuthorizationReq` and `MeteringReceiptReq` messages
        - CPS verifies EVCC signature of `CertificateUpdateReq` messages.
        - MO/CPS/SECC send the new contract certificate to EVCC in element `ContractSignatureCertChain` element of `CertificateInstallationRes` and `CertificateUpdateRes` messages
        - MO/CPS/SECC send the new contract private key in encrypted form (encrypted by MO, signed CPS and communicated by SECC) to EVCC in `ContractSignatureEncryptedPrivateKey` element of `CertificateInstallationRes` and `CertificateUpdateRes` messages
        - MO (or so-called Secondary Actor) sign `SalesTariff` element in `ChargeParameterDiscoveryRes`, which the SECC then transmit to EVCC.
        - EVCC verifies signature of `ChargeParameterDiscoveryRes`
- **MO certificate chain**
    - The chain of certificate comprised of a MO Root CA, 2 intermediate MO sub-CA, and finally a contract certificate.
    - The V2G Root CA may optionally also sign the MO Sub-CA 1 certificate.
    - Used by SECC and possibly other Secondary Actors to verify contract certificate up to a know Root CA.
    - Part of `ContractSignatureCertChain` element of messages `PaymentDetailsReq`, `CertificateUpdateReq`, `CertificateInstallationRes` and `CertificateUpdateRes`.

## **Certificate Provisioning Service (CPS)**

- **CPS leaf certificate**
    - A certificate instance (and its private key) used by a signing service of a CPS actor.
    - Signed by CPS Sub-CA 2, chaining up to the V2G Root CA.
    - Used to sign content of `CertificateInstallationRes` and `CertificateUpdateRes` messages.
- **CPS certificate chain**
    - The chain of certificate comprised of the V2G Root CA, 2 intermediate CPS Sub-CA, and finally a CPS leaf certificate.
    - Used by EVCC to verify the CPS leaf certificate up to the V2G Root CA when installing or updating a contract certificate.
    - SECC transmit from CPS this chain in `SAProvisioningCertificateChain` element of `CertificateInstallationRes` and `CertificateUpdateRes` messages.